# 0126 設計メモ（基本設計書への統合待ち）

## 記事入力画面の詳細UI仕様

### 入力エディタ（MUST）
- **Markdownエディタライブラリ使用**
  - 直接マークダウン記述ではなく、ボタンで要素挿入
  - 見出し: 大見出し、小見出し、本文の3階層
  - 水平線追加ボタン

- **画像機能**
  - 画像挿入
  - トップ画像選択（記事サムネイル）
    - 選択なしの場合は本文中の1枚目を自動選択

- **埋め込み機能**
  - ニュースやURLをiframeで表示

### 入力エディタ（WANT - あったらいい）
- **高度な編集機能**
  - 目次自動生成機能
  - 文字ハイライト機能
  - 画像ドラッグ&ドロップで位置移動
  - 画像キャプション追加機能

- **テキスト装飾**
  - 文字色変更（3色程度）

### 投稿設定画面（MUST）
- ジャンル選択
- 予約投稿設定
- ニュースレター配信チェックボックス
- 紐付け銘柄選択

---

## ニュース画面の表示ロジック（Figmaスクリーンショット参照）

### トレンドニュース（MUST）
- **対象期間**: 直近24時間以内（必須条件）
- **スコアリングロジック**:
  - View数: 1ポイント
  - 人気銘柄紐付き: 2ポイント
  - 人気銘柄の定義: ユーザーのポートフォリオ登録数が多い順
- **計算式**: スコア = (View数 × 1) + (人気銘柄に紐付いている場合 × 2)
- **並び順**: スコア降順
- **表示件数**: 10件
- **レイアウト**: リスト形式、番号付き（1〜10）
- **表示項目**:
  - ニュースタイトル（日本語）
    - DeepLで翻訳
  - 投稿時間（9時間前など相対表示）
  - 掲載元（Reuters、Benzinga等）
  - センチメントラベル（POSITIVE / NEGATIVE）
  - ティッカーシンボル（$NVDA、$TSLA等）

### ジャンル別ニュース表示（MUST）
- **ジャンル数**: 3つ（株式市場、AI、経済など）
  - 初期設定: 株式市場、AI、経済
  - 管理画面からジャンル追加・編集可能
- **各ジャンルの表示件数**: 5件
- **並び順**: 最新順（投稿日時降順）
- **レイアウト**:
  - 最新1件を大きく表示（カード形式）
  - 残り4件をリスト形式で表示
- **表示項目**:
  - ニュースタイトル（日本語）
    - DeepLで翻訳
  - 投稿時間
  - 掲載元
  - センチメントラベル
  - ティッカーシンボル

### ジャンル詳細ページ（MUST）
- **表示形式**: カード形式
- **表示項目（MUST）**:
  - ニュースタイトル（日本語）
    - DeepLで翻訳
  - 掲載元
  - 投稿時間
  - 外部リンク（掲載元サイト）へ遷移
- **フィルター機能（MUST）**:
  - 期間選択（Last 12 Months、Today等）
- **フィルター機能（WANT - あったらいい）**:
  - 検索（Name or Symbol）
  - タイプ選択（All等）
  - センチメントラベル
  - ティッカーシンボル

### ニュース独自ページ（WANT - あったらいい）
- **説明**: ニュース押下時に外部リンクではなく、独自ページへ遷移
- **表示内容**:
  - LLMで日本語訳したニュース本文
  - 元記事へのリンク
  - センチメント分析結果
  - 関連銘柄情報

---

## ニュースレター機能の詳細（MUST）

### 配信仕様
- **頻度**: 毎日朝7時30分（固定）
- **対象**: メールアドレス登録済みユーザー
- **配信件数**: 最大5記事、0件の場合は送信なし

### 記事選択フロー
1. 記事投稿時にチェックボックスを押下
2. 配信リストに記事が追加される
3. 管理画面で配信リスト確認・編集可能
4. 最大5記事まで選択可能

### 要約生成
- LLMを使用して200-300文字に要約
- 要約タイミング: 配信直前 or 記事投稿時（要検討）

---

## 記事とニュースの表示分離（MUST）

### 明確化の方針
- **記事**: 専門家による長文コンテンツ、購読の核心価値
- **ニュース**: 外部取得の速報、補完的情報

### UI上の分離（必須要件）
- ダッシュボードで別セクション表示
- ナビゲーションで明確に区別
- 別ページで表示
- 検索結果でもカテゴリ分離

---

## 次のアクション

このメモの内容を以下に反映する:
- [ ] `docs/versions/1_0_0/system-design.md` の該当セクションに統合
  - 画面設計セクションにニュース画面のレイアウト詳細を追加
  - データ設計セクションにニュースジャンルマスタを追加
- [ ] 詳細設計書（feature-spec）作成時に参照
  - F-02（ニュース機能）の詳細設計時に本メモを参照

## 実施済み
- [x] 要件定義書（requirements.md）の更新
  - F-02-3: トレンドニュース表示（24時間以内×スコアリング順に10個）
    - スコアリングロジック: View数×1pt + 人気銘柄紐付き×2pt
  - F-02-4: ジャンル別ニュース表示（3ジャンル、各5件、最新1件大きく表示）
  - F-02-5: ジャンル詳細ページ（フィルター機能、外部リンク）
  - F-02-7: ニュース独自ページ（WANT、LLM日本語訳）
  - US-11, US-12: ニュース関連ユーザーストーリー追加
  - 用語定義: トレンドニュース、人気銘柄を追加
- [x] SUMMARY.md の更新
- [x] 本メモ内でMUST/WANT分類を明記
  - 記事入力画面: 基本機能はMUST、高度な編集機能はWANT
  - ニュースレター: 基本配信はMUST、カスタマイズ機能はWANT
  - ニュース画面: 基本表示・フィルターはMUST、センチメント・独自ページはWANT
  - 記事/ニュース分離: 基本分離はMUST、高度なUI切替はWANT
- [x] トレンドニュースのスコアリングロジック詳細化
  - 24時間以内（必須条件）
  - View数: 1ポイント
  - 人気銘柄紐付き: 2ポイント（ポートフォリオ登録数順）
  - 計算式とスコア降順表示を明記
