# バージョン 1.0.0 要件定義

## 1. 概要

### 1.1 背景
- 既存サービスはDiscord中心で運用されている
- 利用実態として、アクティブに発言しているユーザーは全体の約1.5%程度に留まり、約98.5%のユーザーは閲覧専用（ROM専）である
- チャット中心の設計は、情報が流れやすく再利用性が低い
- チャットの治安維持や感情的投稿対応に運営リソースが割かれている

### 1.2 目的
- **記事購読型コミュニティ**として、専門家の知見を継続的に届ける
- 専門家の知見・思考プロセスを、初心者にも分かりやすく簡潔に提供する
- ROM専ユーザーを前提とした「読むだけで価値がある体験」を最優先する
- 他プラットフォームでは得られない投資判断材料を、整理されたUIで提供する

### 1.3 サービスの核心価値
**「専門家の記事を購読する」ことがこのサービスの売り**
- ユーザーは記事を読むためにサブスクリプションに加入する
- 記事の質と継続的な発信がサービス価値の源泉
- 銘柄情報やニュースは記事価値を補完する付加機能

## 2. 成功基準

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 記事閲覧率 | MAUの70%以上が月1回以上記事を閲覧 | Metabase |
| サブスク継続率 | 月次解約率10%以下 | Stripe Dashboard |
| ROM専ユーザー満足度 | 80%以上が「満足」と回答 | 定期ユーザーアンケート |
| 記事・ニュース表示速度 | 3秒以内 | Lighthouse |
| 月間アクティブユーザー（MAU） | 800人以上（初年度） | Metabase |

## 3. 対象ユーザー

| ペルソナ | 特徴 |
|---------|------|
| ROM専ユーザー（主要ターゲット） | 既存Discordで閲覧のみの多数派（98.5%）。発言せずに専門家の情報を受け取りたい。能動的な操作は最小限にしたい |
| 投資初心者 | 株式投資を始めたばかり。情報収集方法がわからず、専門用語に抵抗がある。分かりやすい解説と判断材料を求めている |
| アクティブ投資家 | 基礎知識はあるが、大手にない差別化された分析・判断材料を求めている。迅速な情報アクセスを重視 |

## 4. ユーザーストーリー

| ID | ペルソナ | ストーリー | 関連機能 |
|----|---------|-----------|----------|
| US-01 | ROM専ユーザー | ROM専ユーザーとして、ログイン後すぐに今日の注目記事を一目で確認したい。なぜなら能動的に情報を探す手間を省きたいから。 | F-01 |
| US-02 | 投資初心者 | 投資初心者として、気になる銘柄の基本情報と専門家の評価を1ページで確認したい。なぜなら複数サイトを回るのは面倒だから。 | F-03 |
| US-03 | ROM専ユーザー | ROM専ユーザーとして、最新ニュースを日本語で読みたい。なぜなら英語の原文を読む時間がないから。 | F-02 |
| US-04 | アクティブ投資家 | アクティブ投資家として、保有銘柄をまとめたポートフォリオでパフォーマンスを確認したい。なぜなら一括で状況把握したいから。 | F-04 |
| US-05 | ROM専ユーザー | ROM専ユーザーとして、投票結果を見て他ユーザーの意見傾向を知りたい。なぜなら自分の判断の参考にしたいから。 | F-06 |
| US-06 | 投資初心者 | 投資初心者として、気になる記事をブックマークして後で読み返したい。なぜなら一度で理解できないことがあるから。 | F-07 |
| US-07 | アクティブ投資家 | アクティブ投資家として、ポートフォリオに関連するニュースだけをまとめて確認したい。なぜなら効率的に情報収集したいから。 | F-10 |
| US-08 | ROM専ユーザー | ROM専ユーザーとして、専門家の新しい記事が公開されたら見逃さずに読みたい。なぜなら記事を読むことがこのサービスに加入している理由だから。 | F-01 |
| US-09 | 投資初心者 | 投資初心者として、専門家の思考プロセスを記事で学びたい。なぜなら独学では得られない視点を知りたいから。 | F-01 |
| US-10 | ROM専ユーザー | ROM専ユーザーとして、毎朝メールで注目記事の要約を受け取りたい。なぜなら能動的にログインしなくても情報をキャッチアップできるから。 | F-14 |
| US-11 | アクティブ投資家 | アクティブ投資家として、直近24時間で最も注目されているニュースを一目で確認したい。なぜなら市場の関心事を素早く把握したいから。 | F-02-3 |
| US-12 | 投資初心者 | 投資初心者として、AIや経済などジャンル別にニュースを整理して読みたい。なぜなら関心のある分野に絞って情報収集したいから。 | F-02-4, F-02-5 |

## 5. 機能一覧
- ID体系
  - `F-XX`: 大機能
  - `F-XX-Y`: 子機能（大機能の構成要素）
  - `F-XX-Y-Z`: 孫機能（子機能の構成要素）
- 優先度の定義
  - **MUST**: このバージョンで必ず実装する
  - **WANT**: 余裕があれば実装する

| ID | 機能名 | 概要 | 対応ストーリー | 優先度 |
|----|--------|------|---------------|--------|
| F-01 | ログイン機能 | OAuth（Google / Apple / X）による認証 | - | MUST |
| F-02 | ダッシュボード | ログイン後のホーム画面。相場インデックス、記事/ニュースハイライト、ポートフォリオ、関連ニュース、相場異変レーダーを一覧表示 | US-01, US-04, US-07 | MUST |
| F-02-1 | 相場インデックス表示 | S&P500等の主要指数の価格・変動率を表示 | US-01 | MUST |
| F-02-2 | 記事・ニュースハイライト | 最新・人気の記事をカード形式で表示 | US-01, US-08 | MUST |
| F-02-3 | ポートフォリオウィジェット | 登録ポートフォリオのパフォーマンスサマリーを表示 | US-04 | MUST |
| F-02-4 | 関連ニュースウィジェット | ポートフォリオに関連するニュースをリスト表示 | US-07 | MUST |
| F-02-5 | 相場異変レーダー | 全上場銘柄から異常検出した情報を表示 | - | WANT |
| F-03 | 個別銘柄ページ | 株価チャート、ファンダメンタルズ、UOA、レーティング表示 | US-02 | MUST |
| F-03-1 | 株価チャート | 時系列での株価推移表示 | US-02 | MUST |
| F-03-2 | ニュースオーバーレイ | チャート上に値動きがあった日のニュースを表示 | US-02 | MUST |
| F-03-3 | ファンダメンタルズ | EPS、時価総額等の基本指標表示 | US-02 | MUST |
| F-03-4 | インサイダー取引 | 企業内部者（役員等）の株式売買情報を表示 | US-02 | MUST |
| F-03-5 | UOA表示 | Unusual Option Activity（大口オプション取引）表示 | US-02 | MUST |
| F-03-6 | 証券会社レーティング | 買い/保有/売り、目標株価の表示 | US-02 | MUST |
| F-03-7 | 銘柄の関連ニュース | 銘柄に紐づくニュースを日付降順で表示 | US-02, US-07 | MUST |
| F-03-8 | 人気記事/ニュース | 銘柄に紐づく記事・ニュースを直近3ヶ月×View数で表示 | US-02 | MUST |
| F-03-9 | アナリスト格付け | Massive APIによる格付け・コメント表示(ポップアップ) | US-02 | MUST |
| F-04 | 記事機能 | 専門家による記事の作成・編集・公開・予約投稿。ジャンル分け、人気記事表示。ニュースとは明確に分離して表示 | US-01, US-08, US-09 | MUST |
| F-04-1 | 記事作成・編集 | Markdownエディタによる記事作成。見出し（大・小・本文）、画像挿入・ドラッグ移動、iframe埋込、目次自動生成、ハイライト機能 | US-09 | MUST |
| F-04-2 | 予約投稿 | 公開日時を指定した記事公開 | US-08 | MUST |
| F-04-3 | ジャンル分け | 6ジャンル程度(増減可能)で記事を分類表示 | US-01 | MUST |
| F-04-4 | 人気記事 | 72時間以内×View数で人気記事を表示(4件表示。最新1件を大きく表示) | US-01 | MUST |
| F-04-5 | 記事詳細ページ | 1つの記事の全文を表示する画面。タイトル、本文、投稿日時、著者情報、関連銘柄を表示 | US-08, US-09 | MUST |
| F-05 | ニュース機能 | 外部APIから自動取得、日本語翻訳、即時公開。記事とは明確に分離して表示 | US-03, US-11, US-12 | MUST |
| F-05-1 | ニュース自動取得 | 外部APIからニュースを取得しDBに保存 | US-03 | MUST |
| F-05-2 | 日本語翻訳 | ニュースを日本語に翻訳して表示 | US-03 | MUST |
| F-05-3 | トレンドニュース表示 | 直近24時間以内のニュースをスコアリング順に10個表示。スコア=View数×1pt + 人気銘柄紐付き×2pt | US-11 | MUST |
| F-05-4 | ジャンル別ニュース表示 | 3ジャンル（株式市場・AI・経済等、追加可能）で各5件を最新順に表示。最新1件を大きく表示 | US-12 | MUST |
| F-05-5 | ジャンル詳細ページ | ジャンル別のニュース一覧ページ。フィルター機能（期間・タイプ）、外部リンク遷移 | US-12 | MUST |
| F-05-6 | ニュース詳細ページ | ニュース押下時に独自の詳細ページへ遷移し、LLM日本語訳を表示 | - | WANT |
| F-06 | アンケート機能 | 最大9択、1ユーザー1回投票 | US-05 | MUST |
| F-06-1 | アンケート投票画面 | 選択肢別の投票率表示、1ユーザー1回投票 | US-05 | MUST |
| F-07 | 検索機能 | 記事／ニュース／銘柄／アンケートの検索 | - | MUST |
| F-08 | ブックマーク機能 | 記事・ニュース・アンケートのブックマーク | US-06 | MUST |
| F-09 | ポートフォリオ | 銘柄をまとめて管理（最大5つ）、パフォーマンス表示。独自ページと関連ニュースページを持つ | US-04, US-07 | MUST |
| F-09-1 | ポートフォリオ管理画面 | ポートフォリオの作成・編集・削除、銘柄追加・削除 | US-04 | MUST |
| F-09-2 | 関連ニュースページ | ポートフォリオに関連するニュースを独自ページで一覧表示 | US-07 | MUST |
| F-10 | 設定画面 | ユーザー設定の管理画面。アイコン、userId表示、各種設定、FAQ、問い合わせ | - | MUST |
| F-10-1 | プロフィール設定 | アイコン、userId、表示名の確認・編集 | - | MUST |
| F-10-2 | サブスクリプション管理 | Stripe連携、プラン確認・変更、決済失敗時の権限制限 | - | MUST |
| F-10-3 | メールアドレス登録 | ニュースレター受信用メールアドレスの登録・変更。設定画面および各画面に配置されたウィジェットから登録可能 | US-10 | MUST |
| F-10-4 | FAQ・問い合わせ | よくある質問、問い合わせフォームへのリンク | - | MUST |
| F-11 | ニュースレター機能 | メール登録ユーザーに選択した記事の要約を毎日配信（朝7:30）。管理画面で配信リスト管理（最大5記事） | US-10 | MUST |
| F-11-1 | 記事要約生成 | LLMで記事を200-300文字に要約 | US-10 | MUST |
| F-11-2 | 定期配信 | 毎日朝7:30に登録ユーザーへメール送信。配信記事0の場合は送信なし | US-10 | MUST |
| F-12 | 管理者ページ | 管理者専用のダッシュボード。コンテンツ管理、ユーザー管理、設定管理、アナリティクスへのアクセス拠点 | - | MUST |
| F-12-1 | コンテンツ管理 | 全記事・ニュース・アンケートの管理機能 | - | MUST |
| F-12-1-1 | 記事管理 | 全記事の一覧表示、編集、削除、予約投稿管理 | - | MUST |
| F-12-1-2 | ニュース管理 | 全ニュースの一覧表示、編集、削除 | - | MUST |
| F-12-1-3 | アンケート管理 | アンケートの作成、編集、削除、予約投稿管理 | - | MUST |
| F-12-2 | ユーザー管理 | ユーザー一覧、権限付与（記事投稿権限等）、アカウント停止 | - | MUST |
| F-12-3 | ニュースレター管理 | 配信リスト管理（最大5記事）、配信履歴確認。記事投稿時のチェックボックスで配信リストに追加 | US-10 | MUST |
| F-12-4 | 設定管理 | システム設定値の管理（ジャンル設定、表示件数、トレンドスコア係数等） | - | MUST |
| F-12-5 | アナリティクス | Metabaseによる閲覧数・MAU・入退会数の可視化 | - | WANT |


## 6. スコープ外

- プラットフォーム内チャット機能
- コメント機能（検討中のため除外）
- 板情報・リアルタイム売買支援機能
- Discordとの機能連携
- メール＋パスワード認証

### Discordの位置づけ
- Discordはプラットフォームとは切り離して運用する
- 上位プラン特典として「Discord参加権」を付与する予定
- 双方向コミュニケーションはDiscord側に集約する
- **このプロジェクトではDiscord、チャットについて想定する必要はない**

## 7. 制約・前提

### ビジネス制約
- 完全ログイン制（未ログインユーザーは利用不可）
- 完全サブスクリプション制（無料ユーザーは存在しない）
- 運営リソースは記事執筆・ツール開発を最優先
- 高級感・専門性を損なわないUI/UX

### ロール・権限

| ロール | 権限 |
|--------|------|
| 管理者 | 全機能・全データへのアクセス |
| 記事投稿権限ユーザー | 記事投稿・自分の記事削除 |
| 一般ユーザー | 閲覧・投票・いいね・ブックマークのみ |

### プラン構成
* 上位プランについては最初(当バージョン)は不要

| プラン | 内容 |
|--------|------|
| ベースプラン | 記事・ニュース・銘柄ページの閲覧 |
| 上位プラン | 追加機能（オプションフロー可視化等）、Discord参加権 |

## 8. UI/UX共通要件

### 8.1 サイドバー

全画面共通で表示されるナビゲーションコンポーネント。

#### 構成要素

| セクション | 内容 |
|-----------|------|
| **ブランドロゴ** | 上部に配置。クリックでダッシュボードへ遷移 |
| **メインナビゲーション** | ダッシュボード、記事、ニュース、投票 |
| **ユーザーセクション** | アバター、ユーザー名、ロールバッジ、設定 |

#### メニュー項目

| 項目 | アイコン | 遷移先 | 備考 |
|------|---------|--------|------|
| ダッシュボード | layout-collage | F-02 | - |
| 記事 | users | F-04 | 折りたたみ対応（下記参照） |
| ニュース | clipboard-data | F-05 | - |
| 投票 | world | F-06 | - |
| 設定 | settings-2 | F-10 | ユーザーセクション内 |

※ ログアウトは設定画面（F-10）内に配置

#### 記事タブの折りたたみ機能

| 項目 | 内容 |
|------|------|
| 対象 | 記事メニュー項目のみ |
| 展開時の表示内容 | 記事ジャンル一覧（F-04-3で定義された6ジャンル程度） |
| 折りたたみ状態の保持 | ユーザーごとに永続化（DB保存） |
| デフォルト状態 | 折りたたみ（閉じた状態） |
| 操作 | クリックで展開/折りたたみをトグル |

#### 折りたたみ状態の永続化

- ユーザーがサイドバーの記事タブを展開/折りたたみした状態を記録
- 次回ログイン時・ページ遷移時も状態を維持
- ユーザー設定テーブルに`sidebar_article_expanded`フラグとして保存

#### レスポンシブ対応

| デバイス | 表示方式 |
|----------|----------|
| デスクトップ（1024px〜） | 常時表示（固定幅280px） |
| タブレット（768px〜1023px） | ハンバーガーメニューで開閉 |
| モバイル（〜767px） | ハンバーガーメニューで開閉 |

### 8.2 ダークモード対応

| 項目 | 内容 |
|------|------|
| 目的 | ユーザーの利用環境・時間帯問わず快適に閲覧可能にする |
| 実装方式 | CSS変数またはテーマ切り替え機構を使用 |
| デフォルト値 | システム設定に準拠（OSのダークモード設定を継承） |
| 切り替え方法 | 設定画面（F-10）から手動切り替え可能 |
| 対象画面 | 全画面共通 |
| 色設計 | システムテーマ（ライト/ダーク）ごとに別途定義 |

### 8.2 レスポンシブ対応

| 項目 | 内容 |
|------|------|
| 目的 | スマートフォン・タブレット・デスクトップ全てのデバイスで快適に利用可能にする |
| 対象デバイス | スマートフォン（320px〜）、タブレット（768px〜）、デスクトップ（1024px〜） |
| ブレークポイント | Mobile: < 768px, Tablet: 768px〜1023px, Desktop: 1024px〜 |
| 実装方式 | CSSメディアクエリアまたはモダンなCSSレイアウト（Grid/Flexbox） |
| レイアウト方針 | モバイルファーストで設計し、上位デバイス向けに拡張 |
| 対象画面 | 全画面共通 |
| 優先度 | MUST |

### 8.3 カラーコード

Figmaデザインに基づくカラーコード定義。

| カテゴリ | ライトモード | ダークモード | 用途 |
|----------|-------------|-------------|------|
| **背景色** | `#FFFFFF` | `#000000` | メイン背景 |
| **プライマリカラー** | `#E86D00` | `#E86D00` | ボタン・ジャンル名・ラベル |
| **セカンダリテキスト** | `#000000` | `#FFFFFF` | サブタイトル・見出し |
| **ティッカー色** | `#63B7E2` | `#63B7E2` | 銘柄コード（ティッカー） |
| **テキスト（日付・時間等）** | `#D5D5D5` | `#EBEBEB` | 日付・時間 |

**補足**
- プライマリカラー（`#E86D00`）はライト/ダーク共通で維持し、視覚的一貫性を確保
- ティッカー色（`#63B7E2`）は銘柄コード表示に使用
- CSS変数として定義し、テーマ切り替え時に一括適用

## 9. 未確定事項

- [ ] 記事コメント機能の有無・形態
- [ ] ニュース編集時の「編集済み」表示の要否

## 10. 用語定義

| 用語 | 定義 |
|------|------|
| ROM専 | Read Only Member の略。閲覧のみで発言しないユーザー |
| UOA | Unusual Option Activity。大口のオプション取引を検出したもの |
| インサイダー取引 | 企業内部者（役員、取締役等）による自社株の売買取引情報。SECへの届出データを表示 |
| ファンダメンタルズ | EPS、時価総額、PER等の企業の基礎的財務指標 |
| レーティング | 証券会社アナリストによる買い/保有/売りの推奨評価 |
| ポートフォリオ | ユーザーが保有・注目する銘柄をまとめたもの（最大5つ作成可能） |
| シコウラボ | 思考／志向／試行 × ラボ。専門家の思考プロセスを覗ける場 |
| トレンドニュース | 直近24時間以内のニュースをスコアリング順に表示するセクション。スコア=View数×1pt + 人気銘柄紐付き×2pt |
| ニュースジャンル | ニュースを分類するカテゴリ（株式市場・AI・経済等）。初期3ジャンル、追加可能 |
| 人気銘柄 | ユーザーのポートフォリオ登録数が多い銘柄。トレンドニュースのスコアリングに使用 |