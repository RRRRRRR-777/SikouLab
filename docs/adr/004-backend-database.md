# ADR-004: バックエンドDBアクセス・マイグレーションの選定

## ステータス
承認済み

## コンテキスト
GoバックエンドでのDBアクセス方式とスキーマ管理方式の選定が必要。
チームはSQL重視のアプローチを希望し、生SQLで細かく制御したい。

## 決定
- **DBアクセス**: sqlx
- **マイグレーション**: golang-migrate（SQLファイル管理）

## 検討した選択肢

### DBアクセス

| ライブラリ | 特徴 |
|-----------|------|
| GORM | フルORM、オブジェクト指向、SQLを書かない |
| **sqlx** | 生SQL + 構造体マッピング、SQL重視 |
| ent | スキーマファースト、コード生成、Facebook製 |

### スキーマ管理

| 方式 | 特徴 |
|------|------|
| コードからスキーマ生成 | Go構造体とDB同期、マイグレーション不要 |
| **SQLファイル管理** | SQLが明示的、レビューしやすい、複雑な変更も自由 |

### マイグレーションツール

| ツール | 特徴 |
|--------|------|
| **golang-migrate** | シンプル、CLI中心、Docker対応◎ |
| goose | Go埋め込み可能、SQLとGoどちらでも書ける |
| Atlas | 宣言的スキーマ管理、差分検出が強力 |

## 理由
1. **SQL重視**: 生SQLで細かく制御でき、ORMの抽象化によるオーバーヘッドがない
2. **シンプルさ**: sqlxは軽量で学習コストが低い
3. **SQLファイル管理**: 本番適用前にSQLを確認でき、レビューしやすい
4. **golang-migrate**: シンプルで実績豊富、Docker/CI対応が良い

## 影響
- マイグレーションファイルは `backend/migrations/` 配下に配置
- ファイル命名: `000001_create_users.up.sql`, `000001_create_users.down.sql`
- CIでマイグレーションの整合性チェックを行う
