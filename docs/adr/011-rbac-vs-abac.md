# ADR: 権限モデルの選択（RBAC vs ABAC）

## ステータス
採用

## コンテキスト
認証・認可機能の設計において、RBAC（ロールベース）とABAC（属性ベース）のいずれを採用するか検討。

---

## 決定事項
**RBAC（ロールベースアクセス制御）を採用する**

| 項目 | 内容 |
|------|------|
| **ロール** | admin, writer, userの3つ |
| **権限モデル** | ロールベース + 所有者チェック |

---

## 選択肢の比較

### RBAC

**仕組み**: 役割（ロール）に権限を割り当てる方式

| メリット | デメリット |
|----------|-----------|
| シンプルで実装・運用が容易 | 複雑な条件制御には不向き |
| 処理速度が速い | ロールが増えると管理が複雑化 |
| 理解しやすく、デバッグが容易 | 時間・場所等の条件制御ができない |

**具体例**:
- 「writer」ロールは記事の作成・編集ができる
- 「user」ロールは閲覧のみ

---

### ABAC

**仕組み**: ユーザー属性、リソース属性、環境条件を組み合わせて判断する方式

| メリット | デメリット |
|----------|-----------|
| 細かい制御が可能 | 初期設定に時間と専門知識が必要 |
| 動的なルール設定ができる | 処理負荷が高い |
| 時間・場所・デバイス等の条件制御が可能 | 運用・デバッグが複雑 |

**具体例**:
- 「会計部門」かつ「営業時間内」かつ「社内ネットワーク」なら機密ファイルにアクセス可
- 「記事の機密度が高い」場合は管理者のみ閲覧可

---

### ハイブリッド

**仕組み**: RBACを基本とし、必要な箇所にABACを追加する方式

| メリット | デメリット |
|----------|-----------|
| 段階的な移行が可能 | 二重の権限チェックロジックを管理 |
| 現行システムへの影響を最小化 | 設計が複雑になりやすい |

**具体例**:
- 基本はロールで制御
- 特定のリソース（機密度の高い記事）のみ属性ベースで制御

---

## 決定の理由

1. **プロダクトの要件に合致**: ロール3つ、権限パターンも単純（閲覧/投稿/管理）
2. **「作りすぎない」原則**: 初期は最小限、将来的な拡張を壊さない設計
3. **コストパフォーマンス**: 実装・運用コストが低い

---

## もしRBACからABACに移行する場合の工数(概算)

RBACを採用した後、将来的に要件が変化しABACへの移行が必要になった場合の目安：

| フェーズ | 作業内容 | 工数 |
|---------|---------|------|
| 設計 | ABAC設計 | 16時間 |
| 準備 | ポリシーエンジン導入（OPA等） | 16時間 |
| 移行 | 段階的移行 | 48時間 |
| 移行 | 完全移行 | 32時間 |
| テスト | テスト全般 | 48時間 |
| **合計** | | **160時間** |

**ABAC移行を検討するタイミングの目安**:
- ロール数が10以上に増加
- 機密度レベル導入
- チーム/組織機能の追加
- 権限変更頻度が月1回以上
- 詳細なアクセス監査が必要

---

## 影響

- データモデル: 変更なし（現行スキーマで対応）
- 所有者チェック: `articles.author_id` で実現
