---
name: workflow
description: 開発ワークフローの詳細手順。1機能の開発フロー、リリースフロー、V字モデル、実装開始条件、テスト設計を提供
---

# Workflow Skill

## 概要

ウォーターフォール型を基本とし、V字モデルに基づくテスト設計を行う。
本ドキュメントでは「1機能の開発フロー」と「リリースフロー」を定義する。

---

## 1機能の開発フロー

1つの機能を開発し、devブランチにマージするまでの流れ。

```
1. 要件定義確認
   └─ docs/versions/<version>/requirements.md を確認
   └─ 対象機能が機能一覧に存在することを確認

2. 基本設計確認
   └─ docs/versions/<version>/system-design.md を確認
   └─ 機能依存関係・画面設計・データ設計を確認

3. 詳細設計 (/feature-spec)
   └─ docs/functions/<feature-category>/<feature-name>.md を作成
   └─ テストケースセクション含む（単体テスト用）
   └─ API設計（バックエンド機能の場合）:
      ├─ feature-specを参照して backend/api/openapi.yaml を更新
      ├─ 不明点があればユーザーに確認
      └─ OpenAPI記載時に決定した内容はfeature-specに反映
   └─ 全セクション記載 → 自己レビュー → コミット

4. 実装（TDD）
   └─ 設計書のテストケースを先に実装 (Red)
   └─ 機能実装 (Green)
   └─ リファクタリング (Refactor)
   └─ 設計が確定していないものや曖昧なものはユーザーに確認後、設計書更新→実装

5. E2Eテスト実装
   └─ test_scenarios.md の該当シナリオをPlaywrightで実装
   └─ その機能のE2Eが通ることを確認

6. PRマージ
   └─ ticket-xxx → dev-x.x.x.x へPR作成
   └─ CI通過 → マージ → 機能完了
```

### 1機能の完了条件

- [ ] 詳細設計書が完成している
- [ ] 単体テストが全てPass
- [ ] 対応するE2Eテストが通る
- [ ] devブランチへPRがマージされている

---

## リリースフロー

複数機能をまとめて本番環境にデプロイする流れ。

```
1. 開発完了確認
   └─ リリース対象の全機能がdevブランチにマージ済み

2. E2Eシナリオ確認
   └─ docs/versions/<version>/test_scenarios.md が最新化されている

3. リリースPR作成
   └─ dev-x.x.x.x → main へPR作成

4. CI実行（mainマージ後）
   └─ lint, format, 単体テスト, docker build
   └─ 全E2Eテスト実行（dev環境）
   └─ VRT実行

5. 承認・デプロイ
   └─ GitHub Environment承認
   └─ 本番デプロイ実行
```

---

## V字モデル対応

```
要件定義 ────────────────────────────── E2Eテスト（リリース前）
    │                                      │
    └─ requirements.md          test_scenarios.md ─┘
           │                              │
基本設計 ─────────────────────────── E2Eテスト（機能単位）
    │                                      │
    └─ system-design.md         対応シナリオの確認
           │                              │
詳細設計 ────────────────────────── 単体テスト
    │                                      │
    └─ feature-spec             テストケースセクション
           │                              │
           └───────── 実装（TDD） ─────────┘
```

---

## テスト設計の配置

| テスト種別 | 記載場所 | 実行タイミング |
|-----------|----------|---------------|
| 単体テスト | `docs/functions/<feature-category>/<feature-name>.md` 内 | 機能実装時（TDD） |
| E2E（機能単位） | `docs/versions/<version>/test_scenarios.md` | 機能完了前に該当シナリオを確認 |
| E2E（全体） | 同上 | リリース前CI（dev環境） |

---

## 実装開始条件

1. **feature-specの全セクションが記載されていること**
2. **自己レビュー完了**（証跡はコミット履歴）
3. **テストケースセクションが記載されていること**
4. **バックエンド機能の場合、`backend/api/openapi.yaml` が更新されていること**

---

## 実装中のルール

### 設計変更が必要な場合

1. **設計先行**: 設計書を先に更新してから実装
2. 未決定項目は**ユーザーに確認**後、設計書に追記

### 追加テストケースが必要な場合

1. 実装中に発見したテストケースは**設計書に追記**
2. 追記後にテストコードを実装（TDDサイクル維持）

---

## レビュー方針

| フェーズ | レビュー方式 | 証跡 |
|---------|-------------|------|
| 設計書 | 自己レビュー | コミット履歴 |
| 実装 | PRレビュー（任意） | GitHub PR |

---

## ブランチとフローの対応

```
ticket-xxx (機能開発)
    │
    └─→ dev-x.x.x.x (開発ブランチ)  ← 1機能完了時点
              │
              └─→ main (本番ブランチ)  ← リリース時点
```

---

## 関連ドキュメント

- 技術スタック・CI/CD: `docs/development_guidelines.md`
- ドキュメント作成ルール: `.claude/rules/docs.md`
- フロントエンド規約: `.claude/rules/frontend.md`
- バックエンド規約: `.claude/rules/backend.md`
